<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
        xmlns:security="http://www.springframework.org/schema/security"
        xmlns:context="http://www.springframework.org/schema/context"
        xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
                http://www.springframework.org/schema/security
                http://www.springframework.org/schema/security/spring-security-4.0.xsd">
        
	<security:http pattern="/api/health" security="none"/>
	      
        <!-- This is where we configure Spring-Security -->
 	<security:http auto-config="true" use-expressions="true" pattern="/**" entry-point-ref="restAuthenticationEntryPoint" create-session="stateless"> 
 		<security:csrf disabled="true"/>      	    
    		<security:custom-filter before="FORM_LOGIN_FILTER" ref="authenticationFilter"/>  
        	<security:form-login login-page="/error.jsp" authentication-failure-url="/error.jsp"  />
    	</security:http>
        
        <bean id="accessDeniedHandler" class="org.springframework.security.web.access.AccessDeniedHandlerImpl">
                <property name="errorPage" value="/error.jsp" />
        </bean>

	<bean id="authentication" class="libraries.REST.security.types.LTPAAuthenticationToken"/>
	
        <bean id="customAuthenticationProvider" class="libraries.REST.security.RESTAuthenticationProvider"/>

        <bean id="restAuthenticationSuccessHandler" class="libraries.REST.security.RESTAuthenticationSuccessHandler"/>

        <bean id="authenticationFilter" class="libraries.REST.security.AuthenticationFilter">  
        	<property name="authenticationManager" ref="authenticationManager" />
	    	<property name="authentication" ref="authentication" />
       		<property name="authenticationSuccessHandler" ref="restAuthenticationSuccessHandler" />  
    	</bean>
  
        <bean id="restAuthenticationEntryPoint" class="libraries.REST.security.RESTAuthenticationEntryPoint"/>
  		
  	<security:authentication-manager alias="authenticationManager">
                <security:authentication-provider ref="customAuthenticationProvider"/>
        </security:authentication-manager>
</beans>

